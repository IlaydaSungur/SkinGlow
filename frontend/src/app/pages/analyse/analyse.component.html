<div class="page-container">
  <h1>Analyse</h1>

  <!-- Upload + Analyse -->
  <div class="upload-section">
    <label for="file-upload" class="custom-file-upload">
      {{ selectedFile ? selectedFile.name : 'Choose File' }}
    </label>
    <input
      id="file-upload"
      type="file"
      (change)="onFileSelected($event)"
      accept="image/*"
    />

    <button
      class="analyse-btn"
      (click)="processImage()"
      [disabled]="isLoading || !selectedFile"
    >
      {{ isLoading ? 'Analysing...' : 'Analyse' }}
    </button>
  </div>

  <!-- Compare with Shelf -->
  <button
    class="shelf-btn"
    (click)="analyseWithShelf()"
    [disabled]="isLoading || ingredients.length === 0 || isComparing"
  >
    {{ isComparing ? 'Comparing...' : 'Compare with My Shelf' }}
  </button>

  <!-- Error -->
  <div *ngIf="error" class="results-card error-card">
    <h3>Error</h3>
    <p>{{ error }}</p>
  </div>

  <!-- Extracted Text -->
  <div *ngIf="extractedText" class="results-card">
    <h3 (click)="isTextExpanded = !isTextExpanded" class="collapsible-header">
      {{
        isTextExpanded
          ? 'Click to collapse Extracted Text'
          : 'Click to expand Extracted Text'
      }}
    </h3>
    <pre *ngIf="isTextExpanded">{{ extractedText }}</pre>
  </div>

  <!-- Ingredients -->
  <div *ngIf="ingredients.length > 0" class="results-card">
    <h3
      (click)="isIngredientsExpanded = !isIngredientsExpanded"
      class="collapsible-header"
    >
      {{
        isIngredientsExpanded
          ? 'Click to collapse Ingredients'
          : 'Click to expand Ingredients'
      }}
    </h3>
    <ul *ngIf="isIngredientsExpanded">
      <li *ngFor="let item of ingredients">{{ item.name }}</li>
    </ul>
  </div>

  <!-- Analysis -->
  <div *ngIf="analysis.length > 0" class="results-card">
    <h3>Analysis</h3>
    <div
      *ngFor="let item of analysis"
      class="analysis-card"
      [ngClass]="{
        'product-summary': item.type === 'product',
        submatch: item.type === 'submatch',
        info: item.type === 'info'
      }"
    >
      <h4 *ngIf="item.type === 'product'">{{ item.name }}</h4>
      <h5 *ngIf="item.type === 'submatch'">{{ item.name }}</h5>
      <span *ngIf="item.type === 'match' || item.type === 'info'">{{
        item.name
      }}</span>
      <p>{{ item.description }}</p>
      <span
        class="effect"
        [ngClass]="{
          beneficial: item.effect === 'beneficial',
          harmful: item.effect === 'harmful',
          neutral: item.effect === 'neutral'
        }"
      >
        {{ item.effect }}
      </span>
    </div>
  </div>

  <!-- Raw fallback -->
  <div
    *ngIf="!ingredients.length && !analysis.length && raw"
    class="results-card"
  >
    <h3>Raw Result</h3>
    <pre>{{ raw }}</pre>
  </div>
</div>
