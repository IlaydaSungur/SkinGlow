<div class="page-container">
  <h1>Analyse</h1>

  <!-- Upload + Analyse -->
  <div class="upload-section">
    <label for="file-upload" class="custom-file-upload">
      {{ selectedFile ? selectedFile.name : 'Choose File' }}
    </label>
    <input
      id="file-upload"
      type="file"
      (change)="onFileSelected($event)"
      accept="image/*"
    />

    <button
      class="analyse-btn"
      (click)="processImage()"
      [disabled]="isLoading || !selectedFile"
    >
      {{ isLoading ? 'Analysing...' : 'Analyse' }}
    </button>
  </div>

  <!-- Compare with Shelf -->
  <button
    class="shelf-btn"
    (click)="analyseWithShelf()"
    [disabled]="isLoading || ingredients.length === 0 || isComparing"
  >
    {{ isComparing ? 'Comparing...' : 'Compare with My Shelf' }}
  </button>

  <!-- Error -->
  <div *ngIf="error" class="results-card error-card">
    <h3>Error</h3>
    <p>{{ error }}</p>
  </div>

  <!-- Extracted Text -->
  <div *ngIf="extractedText" class="results-card">
    <h3 (click)="isTextExpanded = !isTextExpanded" class="collapsible-header">
      {{
        isTextExpanded
          ? 'Click to collapse Extracted Text'
          : 'Click to expand Extracted Text'
      }}
    </h3>
    <pre *ngIf="isTextExpanded">{{ extractedText }}</pre>
  </div>

  <!-- Ingredients -->
  <div *ngIf="ingredients.length > 0" class="results-card">
    <h3
      (click)="isIngredientsExpanded = !isIngredientsExpanded"
      class="collapsible-header"
    >
      {{
        isIngredientsExpanded
          ? 'Click to collapse Ingredients'
          : 'Click to expand Ingredients'
      }}
    </h3>
    <ul *ngIf="isIngredientsExpanded">
      <li *ngFor="let item of ingredients">{{ item.name }}</li>
    </ul>
  </div>

  <!-- Analysis -->
  <div *ngIf="analysis.length > 0" class="results-card">
    <h3>Analysis</h3>
    <div
      *ngFor="let item of analysis"
      class="analysis-card"
      [ngClass]="{
        'product-summary': item.type === 'product',
        submatch: item.type === 'submatch',
        'safety safe': item.type === 'safety' && item.effect === 'beneficial',
        'safety harmful': item.type === 'safety' && item.effect === 'harmful',
        info: item.type === 'info'
      }"
    >
      <h4 *ngIf="item.type === 'product' || item.type === 'safety'">
        {{ item.name }}
      </h4>
      <p *ngIf="item.description">{{ item.description }}</p>
    </div>
  </div>
  <!-- Add to Shelf -->
<button
class="shelf-btn"
(click)="openShelfModal()"
[disabled]="isLoading || ingredients.length === 0"
>
Add to My Shelf
</button>



  <!-- Raw fallback -->
  <div
    *ngIf="!ingredients.length && !analysis.length && raw"
    class="results-card"
  >
    <h3>Raw Result</h3>
    <pre>{{ raw }}</pre>
  </div>

  <!-- Add to Shelf Modal -->
<div class="modal" *ngIf="showShelfModal">
  <div class="modal-content">
    <h3>Add Product to Shelf</h3>
    <form (ngSubmit)="submitShelfForm()" #shelfForm="ngForm">
      <input
        type="text"
        name="name"
        [(ngModel)]="shelfFormData.name"
        placeholder="Product Name"
        required
      />
      <input
        type="text"
        name="brand"
        [(ngModel)]="shelfFormData.brand"
        placeholder="Brand"
        required
      />


      <select name="type" [(ngModel)]="shelfFormData.type" required>
        <option value="" disabled selected>Select Type</option>
        <option value="moisturizer">Moisturizer</option>
        <option value="serum">Serum</option>
        <option value="cleanser">Cleanser</option>
        <option value="sunscreen">Sunscreen</option>
        <option value="other">Other</option>
      </select>

      <button type="submit">Add</button>
      <button type="button" (click)="showShelfModal = false">Cancel</button>
    </form>
  </div>
</div>





</div>
